@model Metas.AplicacionWeb.Models.ViewModels.VMProgramacion

@{
    ViewData["Title"] = "Registrar Programación";
}

<div class="container-fluid mt-5">
    <h1 class="text-center mb-4 titulo fw-semibold pt-2 glass-effect rounded-5 pb-2">FICHA TÉCNICA DE ACTIVIDADES</h1>

    @* Datos del solicitante *@
    <div class="d-flex border mb-4 rounded-4 shadow">
        <div class="w-25 p-3 rounded-start-4 align-content-center glass-effect">
            <h5 class="fw-semibold titulo text-center">
                Datos del solicitante
            </h5>
        </div>

        <div class="w-75">
            <div class="d-flex border-bottom p-2">
                <div class="w-50 my-2">1. FECHA DE ELABORACIÓN:</div>
                <div class="w-50 fw-semibold text-center my-2">@DateTime.Now.ToString("dd/MM/yyyy")</div>
            </div>

            <div class="d-flex p-2 row">
                <label class="col-md-4 align-content-center">2. NOMBRE DEL ÁREA OPERATIVA <br /> RESPONSABLE (AOR):</label>
                <div class="col-8 row">
                    <div class="col-md-6">
                        <h5 class="fw-light">
                           Area:   
                        </h5>
                        <textarea disabled class="form-control input-arena titulo fw-semibold" rows="1" id="inputArea">@Model.AreaNombre</textarea>
                    </div>
                    <div class="col-md-6">
                        <h5 class="fw-light">
                            Departamento:
                        </h5>
                        <textarea disabled class="form-control input-arena titulo fw-semibold" rows="1" id="inputDepartamento">@Model.DepartamentoNombre</textarea>
                    </div>                   
                </div>
            </div>

            <div class="d-flex p-2">
                <div class="w-50 align-content-center">3. CORREO ELECTRÓNICO:</div>
                <div class="w-50 my-2 mx-2">
                    <input type="email" class="input-arena form-control titulo" placeholder="ejemplo@correo.com" id="inputCorreo" value="@Model.CorreoContacto">
                </div>
            </div>
        </div>
    </div>

    @* Datos de la solicitud *@
    <div class="p-3 mb-4 rounded-4 shadow">
        <h5 class="mb-2 text-center border-bottom pb-3 fw-semibold titulo pt-2 glass-effect rounded-5">DATOS DE LA SOLICITUD</h5>

        <div class="row my-3 border-bottom pb-3">
            <label class="col-md-6 align-content-center">4. PROGRAMA PRESUPUESTARIO / AGENDA INSTITUCIONAL:</label>
            <div class="col-md-6 align-content-center">
                <select class="input-arena form-control titulo" id="selectPrograma" name="selectPrograma">
                    <option value="">Seleccione Programa</option>
                    @foreach (var act in Model.ListaProgramas)
                    {
                        <option value="@act.Value">@act.Text</option>
                    }
                </select>
            </div>
        </div>

        <div class="row mb-3 border-bottom pb-3">
            <label class="align-content-center col-md-6">5. NÚMERO DE COMPONENTE:</label>
            <div class="col-md-6 align-content-center">
                <select class="input-arena form-control titulo" id="selectComponente" name="selectComponente" disabled>
                    <option value="">-- Selecciona componente --</option>
                    @foreach (var componente in Model.ListaComponentes)
                    {
                        <option value="@componente.Value" data-programa="@componente.Group.Name">
                            @componente.Text
                        </option>
                    }
                </select>
            </div>
        </div>

        <div class="row pb-1 border-bottom mb-3 pb-3">
            <label class="align-content-center col-md-6">6. NÚMERO DE ACTIVIDAD:</label>
            <div class="col-md-6 align-content-center">
                <input type="number" class="input-arena form-control titulo" id="inputActividad">
            </div>
        </div>   
        @* Justificacion *@
        <div class="border-bottom mb-3 pb-3">
            <label>7. JUSTIFICACIÓN</label>
            <textarea class="input-arena form-control" rows="2" id="inputJustificacion"></textarea>
        </div>

        @* Documentacion soporte de la justificacion *@
        <div class="mb-3 pb-3 border-bottom">
            <label>8. DOCUMENTACIÓN SOPORTE DE LA JUSTIFICACIÓN</label>
            <textarea class="input-arena form-control" rows="2" id="inputDocumentacion"></textarea>
        </div>

        @* Origen de recursos *@
        <div class="d-flex align-items-center py-2 pb-4">
            <div class="w-50 pe-3 mt-2 align-items-center">
                <label>9. ORIGEN DE RECURSOS</label>
            </div>

            <div class="w-50 mt-2">
                <div class="row g-2">
                    <div class="col-6">
                        <h5 class="fw-light">Recurso Federal</h5>
                        <select class="input-arena form-control titulo" id="selectFederal">
                            <option value="">Seleccione</option>
                            <option value="Si">Sí</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <div class="col-6">
                        <h5 class="fw-light">Recurso Estatal</h5>
                        <select class="input-arena form-control titulo" id="selectEstatal">
                            <option value="">Seleccione</option>
                            <option value="Si">Sí</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>    

    <hr>

    @* Datos generales *@
    <h2 class="text-center my-4 titulo fw-semibold pt-2 pb-2 glass-effect rounded-5 ">DATOS GENERALES</h2>
    
    <div class="border p-3 mb-4 mt-4 rounded-4 shadow">
        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">10. PROGRAMA SOCIAL, SERVICIO Y/O PROYECTO</label>
            <div class="col-md-8 mb-3">
                <textarea id="inputPrograma" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>
        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">11. DESCRIPCIÓN DE LA ACTIVIDAD</label>
            <div class="col-md-8 my-3">
                <textarea id="inputDescripcion" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>
        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">12. NOMBRE DEL INCICADOR</label>
            <div class="col-md-8 my-3">
                <textarea id="inputIndicador" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>
        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">13. DEFINICIÓN DEL INCICADOR</label>
            <div class="col-md-8 my-3">
                <textarea id="inputDefinicion" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>

        @* Calendarización *@

        <div class="row border-bottom py-3 mb-3">
            <label class="col-md-4 align-content-center">14. CALENDARIZACIÓN</label>
        </div>

        <div class="row">
            @* Encabezados de trimestres *@
            <div class="col-md-3 mb-3">
                <div class="text-center fw-semibold text-muted">TRIMESTRES</div>
            </div>
            <div class="col-md-2 mb-3">
                <div class="text-center titulo fw-semibold border-bottom pb-1">1ER TRIMESTRE</div>
            </div>
            <div class="col-md-2 mb-3">
                <div class="text-center titulo fw-semibold border-bottom pb-1">2DO. TRIMESTRE</div>
            </div>
            <div class="col-md-2 mb-3">
                <div class="text-center titulo fw-semibold border-bottom pb-1">3ER. TRIMESTRE</div>
            </div>
            <div class="col-md-2 mb-3">
                <div class="text-center titulo fw-semibold border-bottom pb-1">4TO. TRIMESTRE</div>
            </div>
        </div>

        @* Fila para SERVICIOS *@
        <div class="row align-items-center pb-2 mb-2">
            <div class="col-md-3 text-center">
                <label class="fw-light">SERVICIOS</label>
            </div>
            <div class="col-md-2">
                <input type="number" id="primerServicio" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="segundoServicio" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="tercerServicio" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="cuartoServicio" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
        </div>

        @* Fila para PERSONAS *@
        <div class="row align-items-center mb-3">
            <div class="col-md-3 text-center">
                <label class="fw-light">PERSONAS</label>
            </div>
            <div class="col-md-2">
                <input type="number" id="primerPersona" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="segundoPersona" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="tercerPersona" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
            <div class="col-md-2">
                <input type="number" id="cuartoPersona" class="input-arena form-control titulo text-center" value="0" min="0">
            </div>
        </div>

        <div class="row border-bottom border-top">
            <label class="col-md-4 align-content-center">15. UNIDAD DE MEDIDA</label>
            <div class="col-md-8 my-3">
                <select class="input-arena mt-2 form-control titulo" id="selectMedida">
                    <option value="">Seleccione opción</option>
                    @foreach (var act in Model.ListaMedidas)
                    {
                        <option value="@act.Value">@act.Text</option>
                    }
                </select>
            </div>
        </div>

        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">16. MEDIOS DE VERIFICACIÓN</label>
            <div class="col-md-8 my-3">
                <textarea id="inputMedios" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>

        <div class="row border-bottom">
            <label class="col-md-4 align-content-center">17. SERIE DE INFORMACIÓN DISPONIBLE</label>
            <div class="col-md-4 my-3">
                <select class="titulo form-select input-arena" id="selectDesde">
                    <option value="">Seleccione Desde</option>
                    @{
                        var anoActual = DateTime.Now.Year;
                        var anoMinimo = anoActual - 5;

                        for (int ano = anoActual; ano >= anoMinimo; ano--)
                        {
                            <option value="@ano">@ano</option>
                        }
                    }
                </select>
            </div>

            <div class="col-md-4 my-3">
                <select class="titulo form-select input-arena" id="selectHasta">
                    <option value="">Seleccione Hasta</option>
                    @{
                        for (int ano = anoActual; ano >= anoMinimo; ano--)
                        {
                            <option value="@ano">@ano</option>
                        }
                    }
                </select>
            </div>
        </div>

        <div class="row border-bottom mb-2">
            <label class="col-md-4 align-content-center">18. FUENTES DE INFORMACIÓN</label>
            <div class="col-md-8 my-3">
                <textarea id="inputFuentes" class="input-arena form-control" rows="2" placeholder=""></textarea>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 border-end my-3">
                <div class="row align-items-center h-100">
                    <div class="col-md-6">
                        <label class="mb-0 d-flex align-items-center h-100">19. INTERVIENEN DELEGACIONES REGIONALES</label>
                    </div>
                    <div class="col-md-6">
                        <select id="selectDelegaciones" class="input-arena form-control titulo">
                            <option value="">Seleccione</option>
                            <option value="Si">Sí</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="row align-items-center h-100">
                    <div class="col-md-6">
                        <label class="mb-0 d-flex align-items-center h-100">20. ¿DE QUÉ MANERA?</label>
                    </div>
                    <div class="col-md-6">
                        <textarea id="inputDelegaciones" class="input-arena form-control" rows="2" placeholder=""></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    @* Determinación de Metas *@
    <div class="border p-3 mb-4 rounded-4 shadow">
        <h5 class="pt-2 glass-effect rounded-5 text-center border-bottom pb-2 fw-semibold titulo">DETERMINACIÓN DE METAS</h5>

        <div class="row">
            <div class="col-md-6 border-end">
                <div class="text-center fw-light py-2 border-bottom" style="background-color: #F4F4F4">
                    LÍNEA BASE
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">21. AÑO</label>
                    </div>
                    <div class="col-md-6">
                        <select class="input-arena form-control titulo" id="selectAnoBase">
                            <option value="">Seleccione Año</option>
                            @{
                                for (int ano = anoActual; ano >= anoMinimo; ano--)
                                {
                                    <option value="@ano">@ano</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">22. PORCENTAJE DE CUMPLIMIENTO</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputPorcentajeBase" type="number" class="input-arena form-control titulo text-center" value="0" min="0" max="100">
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">23. NO. DE BIEN O SERVICIO ENTREGADO</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputServicioBase" type="number" class="input-arena form-control titulo text-center" value="0" min="0">
                    </div>
                </div>

                <div class="row align-items-center py-2">
                    <div class="col-md-6">
                        <label class="mb-0">24. NO. DE PERSONAS ATENDIDAS</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputPersonasBase" type="number" class="input-arena form-control titulo text-center" value="0" min="0">
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="text-center fw-light py-2 border-bottom" style="background-color: #F4F4F4">
                    META Y PERIODO DE CUMPLIMIENTO
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">25. AÑO</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputAnoMeta" type="text" class="input-arena form-control titulo text-center fw-semibold" value="@Model.AnoFiscal" disabled readonly>
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">26. PORCENTAJE DE CUMPLIMIENTO</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputPorcentajeMeta" type="number" class="input-arena form-control titulo text-center" value="0" min="0" max="100">
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-6">
                        <label class="mb-0">27. NO. DE BIEN O SERVICIO A ENTREGAR</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputServicioMeta" type="number" class="input-arena form-control titulo text-center" value="0" min="0">
                    </div>
                </div>

                <div class="row align-items-center py-2">
                    <div class="col-md-6">
                        <label class="mb-0">28. NO. DE PERSONAS POR ATENDER</label>
                    </div>
                    <div class="col-md-6">
                        <input id="inputServicioMetas" type="number" class="input-arena form-control titulo text-center" value="0" min="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Meta Anual *@
    <div class="border p-3 mb-4 rounded-4 shadow" id="metaAnualForm">
        <h5 class="mb-2 text-center border-bottom pb-3 fw-semibold titulo pt-2 glass-effect rounded-5">META ANUAL</h5>

        @* Sección Bien/Servicio y Personas *@
        <div class="border-bottom pb-3">
            <div class="row">
                <!-- Primera columna - Bien o Servicio -->
                <div class="col-md-6 border-end align-content-center">
                    <div class="row align-items-center py-2 ">
                        <div class="col-md-12">
                            <label class="mb-0 align-content-center">29. BIEN O SERVICIO</label>
                        </div>
                    </div>
                </div>

                <!-- Segunda columna - Personas y Acumulable -->
                <div class="col-md-6">
                    <div class="row align-items-center py-2">
                        <div class="col-md-4">
                            <label class="mb-0">30. PERSONAS</label>
                        </div>
                        <div class="col-md-8">
                            <select class="input-arena form-control titulo" id="selectPersonas">
                                <option value="">Seleccione Personas / Instituciones</option>
                                <option value="Personas">Personas</option>
                                <option value="instituciones">Instituciones</option>
                            </select>
                        </div>
                    </div>

                    <div class="row align-items-center py-2">
                        <div class="col-md-4">
                            <label class="mb-0">Acumulable</label>
                        </div>
                        <div class="col-md-8">
                            <select class="input-arena form-control titulo" id="selectAcumulable">
                                <option value="">Seleccione opción</option>
                                <option value="no">No</option>
                                <option value="si">Sí</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* Sección Meses *@
        <div class="mt-4">

            @{
                var mesesPrimerSemestre = new[] { "ENE", "FEB", "MAR", "ABR", "MAY", "JUN" };
                var mesesSegundoSemestre = new[] { "JUL", "AGO", "SEP", "OCT", "NOV", "DIC" };
            }

            <div class="row mt-3">              
                <div class="col-md-6 border-end">
                    @* Primera fila - Primer semestre *@
                    <div class="row text-center ">
                        @foreach (var mes in mesesPrimerSemestre)
                        {
                            <div class="col-2 p-1 glass-effect rounded">@mes</div>
                        }
                    </div>
                    <div class="row text-center">
                        @foreach (var mes in mesesPrimerSemestre)
                        {
                            <div class="col-2 p-1">
                                <input type="number" class="input-arena form-control titulo text-center mes-grupo1"
                                       value="0" min="0" data-mes="@mes">
                            </div>
                        }
                    </div>

                    @* Segunda fila - Segundo semestre *@
                    <div class="row text-center mt-2">
                        @foreach (var mes in mesesSegundoSemestre)
                        {
                            <div class="col-2 p-1 glass-effect rounded">@mes</div>
                        }
                    </div>
                    <div class="row text-center">
                        @foreach (var mes in mesesSegundoSemestre)
                        {
                            <div class="col-2 p-1">
                                <input type="number" class="input-arena form-control titulo text-center mes-grupo1"
                                       value="0" min="0" data-mes="@mes">
                            </div>
                        }
                    </div>
                </div>

                @* Grupo 2 - Derecha *@
                <div class="col-md-6">
                    @* Primera fila - Primer semestre *@
                    <div class="row text-center">
                        @foreach (var mes in mesesPrimerSemestre)
                        {
                            <div class="col-2 p-1 glass-effect rounded">@mes</div>
                        }
                    </div>
                    <div class="row text-center">
                        @foreach (var mes in mesesPrimerSemestre)
                        {
                            <div class="col-2 p-1">
                                <input type="number" class="input-arena form-control titulo text-center mes-grupo2"
                                       value="0" min="0" disabled data-mes="@mes">
                            </div>
                        }
                    </div>

                    @* Segunda fila - Segundo semestre *@
                    <div class="row text-center mt-2">
                        @foreach (var mes in mesesSegundoSemestre)
                        {
                            <div class="col-2 p-1 glass-effect rounded">@mes</div>
                        }
                    </div>
                    <div class="row text-center">
                        @foreach (var mes in mesesSegundoSemestre)
                        {
                            <div class="col-2 p-1">
                                <input type="number" class="input-arena form-control titulo text-center mes-grupo2"
                                       value="0" min="0" disabled data-mes="@mes">
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        @* Sección Valores y Resultados *@
        <div class="row mt-4 border-top pt-3">
            <div class="col-md-6 border-end pe-3">
                @* Valor de servicios *@
                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-8">
                        <label class="mb-0 fw-semibold">Valor de servicios</label>
                    </div>
                    <div class="col-md-4">
                        <input class="input-arena form-control titulo text-center fw-bold"
                               id="valorServicios" value="0" disabled>
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-8">
                        <label class="mb-0 fw-semibold">Valor de servicios por municipio</label>
                    </div>
                    <div class="col-md-4">
                        <input class="input-arena form-control titulo text-center"
                               id="valorServiciosMunicipio" disabled value="0">
                    </div>
                </div>

                @* Sección Grupo 1 - Personas atendidas *@
                <div class="mt-4">
                    <div class="row align-items-center py-3">
                        <div class="col-md-8">
                            <select class="input-arena form-control titulo" id="selectEstadoGrupo1">
                                <option value="">Seleccione un municipio</option>
                                @foreach (var act in Model.ListaMunicipios)
                                {
                                    <option value="@act.Value">@act.Text</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="number" class="input-arena form-control titulo text-center"
                                   id="personasAtendidasGrupo1" value="0" min="0" placeholder="Número">
                        </div>
                    </div>

                    <div class="text-center mt-2">
                        <button class="titulo boton-rojo fs-6" id="btnAgregarGrupo1">Agregar</button>
                    </div>

                    @* Tabla Grupo 1 *@
                    <div class="mt-3" id="tablaGrupo1" style="display: none;">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Personas Atendidas</th>
                                        <th>Municipio</th>
                                        <th>Región</th>
                                        <th>Número de región</th>
                                        <th>Clave del municipio</th>
                                        <th>Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyGrupo1">
                                </tbody>
                                <tfoot>
                                    <tr class="fw-bold" style="background-color: #e9ecef;">
                                        <td id="totalGrupo1">0</td>
                                        <td colspan="5" class="text-end">Total Grupo Principal</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 ps-3">
                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-8">
                        <label class="mb-0 fw-semibold">Valor de personas</label>
                    </div>
                    <div class="col-md-4">
                        <input class="input-arena form-control titulo text-center fw-bold"
                               id="valorPersonas" disabled value="0">
                    </div>
                </div>

                <div class="row align-items-center border-bottom py-2">
                    <div class="col-md-8">
                        <label class="mb-0 fw-semibold">Valor de personas por municipio</label>
                    </div>
                    <div class="col-md-4">
                        <input class="input-arena form-control titulo text-center"
                               id="valorPersonasMunicipio" disabled value="0">
                    </div>
                </div>

                @* Sección Grupo 2 *@
                <div class="mt-4">
                    
                    <div class="row align-items-center py-3">
                        <div class="col-md-8">
                            <select class="input-arena form-control titulo" id="selectEstadoGrupo2">
                                <option value="">Seleccione un municipio</option>
                                @foreach (var act in Model.ListaMunicipios)
                                {
                                    <option value="@act.Value">@act.Text</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="number" class="input-arena form-control titulo text-center"
                                   id="personasAtendidasGrupo2" value="0" min="0" placeholder="Número">
                        </div>
                    </div>

                    <div class="text-center mt-2">
                        <button class="titulo boton-rojo fs-6" id="btnAgregarGrupo2">Agregar</button>
                    </div>

                    @* Tabla Grupo 2  *@
                    <div class="mt-3" id="tablaGrupo2" style="display: none;">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Personas Atendidas</th>
                                        <th>Municipio</th>
                                        <th>Región</th>
                                        <th>Número de región</th>
                                        <th>Clave del municipio</th>
                                        <th>Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyGrupo2">
                                </tbody>
                                <tfoot>
                                    <tr class="fw-bold" style="background-color: #e9ecef;">
                                        <td id="totalGrupo2">0</td>
                                        <td colspan="5" class="text-end">Total Grupo Acumulable</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 

    @* Acciones necesarias para realizar la actividad principal *@
    <div class="border p-3 mb-4 rounded-4 shadow" id="accionesContainer">
        <div class="mb-2 text-center pb-1">
            <h5 class="pt-2 glass-effect rounded-5 mb-2 text-center border-bottom pb-3 fw-semibold titulo">
                ACCIONES NECESARIAS PARA REALIZAR LA ACTIVIDAD PRINCIPAL
            </h5>
        </div>

        <!-- Contenedor de acciones - 3 por defecto -->
        <div id="accionesList">
            <!-- Acción 1 -->
            <div class="border rounded p-3 mb-3 accion-item" data-numero="1">
                <div class="row align-items-center mb-3">
                    <div class="col-md-12">
                        <h6 class="fw-semibold mb-0 titulo">1. ACCIÓN</h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label fw-semibold small">DESCRIPCIÓN DE LA ACCIÓN</label>
                        <textarea class="form-control titulo input-arena" rows="3" placeholder="Describa la acción necesaria..."></textarea>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold small">FRECUENCIA DE REALIZACIÓN</label>
                        <select class="form-control titulo input-arena">
                            <option value="">Seleccione la frecuencia</option>
                            <option value="mensual">MENSUAL</option>
                            <option value="trimestral">TRIMESTRAL</option>
                            <option value="anual">ANUAL</option>
                        </select>
                    </div>
                    <div class="col-md-8">
                        <label class="form-label fw-semibold small">FECHA INICIO</label>
                        <input type="date" class="form-control titulo input-arena fecha-inicio">
                    </div>
                </div>
            </div>

            <!-- Acción 2 -->
            <div class="border rounded p-3 mb-3 accion-item" data-numero="2">
                <div class="row align-items-center mb-3">
                    <div class="col-md-12">
                        <h6 class="fw-semibold mb-0 titulo">2. ACCIÓN</h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label fw-semibold small">DESCRIPCIÓN DE LA ACCIÓN</label>
                        <textarea class="form-control titulo input-arena" rows="3" placeholder="Describa la acción necesaria..."></textarea>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold small">FRECUENCIA DE REALIZACIÓN</label>
                        <select class="form-control titulo input-arena">
                            <option value="">Seleccione la frecuencia</option>
                            <option value="mensual">MENSUAL</option>
                            <option value="trimestral">TRIMESTRAL</option>
                            <option value="anual">ANUAL</option>
                        </select>
                    </div>
                    <div class="col-md-8">
                        <label class="form-label fw-semibold small">FECHA INICIO</label>
                        <input type="date" class="form-control titulo input-arena fecha-inicio">
                    </div>
                </div>
            </div>

            <!-- Acción 3 -->
            <div class="border rounded p-3 mb-3 accion-item" data-numero="3">
                <div class="row align-items-center mb-3">
                    <div class="col-md-12">
                        <h6 class="fw-semibold mb-0 titulo">3. ACCIÓN</h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label fw-semibold small">DESCRIPCIÓN DE LA ACCIÓN</label>
                        <textarea class="form-control titulo input-arena" rows="3" placeholder="Describa la acción necesaria..."></textarea>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold small">FRECUENCIA DE REALIZACIÓN</label>
                        <select class="form-control titulo input-arena">
                            <option value="">Seleccione la frecuencia</option>
                            <option value="mensual">MENSUAL</option>
                            <option value="trimestral">TRIMESTRAL</option>
                            <option value="anual">ANUAL</option>
                        </select>
                    </div>
                    <div class="col-md-8">
                        <label class="form-label fw-semibold small">FECHA INICIO</label>
                        <input type="date" class="form-control titulo input-arena fecha-inicio">
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de control -->
        <div class="row mt-3">
            <div class="col-md-12 text-center">
                <button class="boton-rojo me-2" id="btnAgregarAccion" style="width: 50px; height: 50px;">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="boton-amarillo" id="btnEliminarAccion" style="width: 50px; height: 50px;">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="p-3 mb-4 rounded-4 shadow">
        <div class="row p-3">            
            <div class="col-md-4 text-center border-end">
                <label class="fw-semibold d-block mb-2">Elaboró</label>
                <input type="text" id="inputElaboro" class="form-control text-center mb-2 input-arena" placeholder="Nombre" />
                <input type="text" id="inputElaboroCargo" class="form-control text-center input-arena" placeholder="Cargo" />
            </div>

            <div class="col-md-4 text-center border-end">
                <label class="fw-semibold d-block mb-2">Revisó</label>
                <input type="text" id="inputReviso" class="form-control text-center mb-2 input-arena" placeholder="Nombre" />
                <input type="text" id="inputRevisoCargo" class="form-control text-center  input-arena" placeholder="Cargo" />
            </div>

            <div class="col-md-4 text-center">
                <label class="fw-semibold d-block mb-2">Autorizó</label>
                <input type="text" id="inputAutorizo" class="form-control text-center mb-2 input-arena" placeholder="Nombre" />
                <input type="text" id="inputAutorizoCargo" class="form-control text-center input-arena" placeholder="Cargo" />
            </div>
        </div>
    </div>

    <div class="text-center mb-2">
        <button class="boton-rojo">Guardar</button>
    </div>

</div>

@section Scripts {
    <script>
        // ========================================
        // VARIABLES GLOBALES
        // ========================================
        let datosEstados = {};
        let contadorAcciones = 3;
        const MAX_ACCIONES = 6;
        const MIN_ACCIONES = 3;

        // ========================================
        // FUNCIONES DE CARGA DE DATOS
        // ========================================
        async function cargarMunicipios() {
            try {
                const response = await fetch('/Programacion/ObtenerMunicipiosJson');
                if (!response.ok) throw new Error('Error al cargar municipios');

                const municipios = await response.json();

                datosEstados = {};
                municipios.forEach(m => {
                    datosEstados[m.id] = {
                        municipio: m.municipio,
                        region: m.region,
                        numeroRegion: m.numeroRegion,
                        clave: m.clave
                    };
                });

            } catch (error) {
                console.error('Error al cargar municipios:', error);
                alert('Error al cargar los municipios. Por favor, recargue la página.');
            }
        }

        // ========================================
        // FUNCIONES DE ACCIONES
        // ========================================
        function getAccionTemplate(numero) {
            return `
                <div class="border rounded p-3 mb-3 accion-item" data-numero="${numero}">
                    <div class="row align-items-center mb-3">
                        <div class="col-md-12">
                            <h6 class="fw-semibold mb-0 titulo">${numero}. ACCIÓN</h6>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="form-label fw-semibold small">DESCRIPCIÓN DE LA ACCIÓN</label>
                            <textarea class="form-control titulo input-arena" rows="3" placeholder="Describa la acción necesaria..."></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label fw-semibold small">FRECUENCIA DE REALIZACIÓN</label>
                            <select class="form-control titulo input-arena">
                                <option value="">Seleccione la frecuencia</option>
                                <option value="mensual">MENSUAL</option>
                                <option value="trimestral">TRIMESTRAL</option>
                                <option value="anual">ANUAL</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label fw-semibold small">FECHA INICIO</label>
                            <input type="date" class="form-control titulo input-arena fecha-inicio">
                        </div>
                    </div>
                </div>
            `;
        }

        function actualizarNumeros() {
            document.querySelectorAll('.accion-item').forEach((accion, index) => {
                const numero = index + 1;
                accion.setAttribute('data-numero', numero);
                accion.querySelector('h6').textContent = `${numero}. ACCIÓN`;
            });
        }

        function actualizarBotones(btnAgregar, btnEliminar) {
            btnAgregar.disabled = contadorAcciones >= MAX_ACCIONES;
            btnEliminar.disabled = contadorAcciones <= MIN_ACCIONES;
        }

        function configurarAcciones() {
            const accionesList = document.getElementById('accionesList');
            const btnAgregar = document.getElementById('btnAgregarAccion');
            const btnEliminar = document.getElementById('btnEliminarAccion');

            // Agregar acción
            btnAgregar.addEventListener('click', function() {
                if (contadorAcciones < MAX_ACCIONES) {
                    contadorAcciones++;
                    accionesList.insertAdjacentHTML('beforeend', getAccionTemplate(contadorAcciones));
                    actualizarNumeros();
                    actualizarBotones(btnAgregar, btnEliminar);
                }
            });

            // Eliminar acción
            btnEliminar.addEventListener('click', function() {
                if (contadorAcciones > MIN_ACCIONES) {
                    document.querySelector('.accion-item:last-child').remove();
                    contadorAcciones--;
                    actualizarNumeros();
                    actualizarBotones(btnAgregar, btnEliminar);
                }
            });

            // Inicializar botones
            actualizarBotones(btnAgregar, btnEliminar);
        }

        // ========================================
        // FUNCIONES DE CÁLCULO
        // ========================================
        function calcularTotalPersonas(grupo) {
            let total = 0;
            document.querySelectorAll(`#tbody${grupo} tr`).forEach(fila => {
                total += parseInt(fila.cells[0].textContent) || 0;
            });
            document.getElementById(`total${grupo}`).textContent = total;
            return total;
        }

        function calcularSumatorias() {
            const selectAcumulable = document.getElementById('selectAcumulable');
            let sumaGrupo1 = 0;
            let sumaGrupo2 = 0;

            document.querySelectorAll('.mes-grupo1').forEach(input => {
                sumaGrupo1 += parseInt(input.value) || 0;
            });

            if (selectAcumulable.value === 'si') {
                document.querySelectorAll('.mes-grupo2').forEach(input => {
                    sumaGrupo2 += parseInt(input.value) || 0;
                });
            }

            document.getElementById('valorServicios').value = sumaGrupo1;
            document.getElementById('valorPersonas').value = sumaGrupo2;

            actualizarMaximosPersonas(sumaGrupo1, sumaGrupo2);
            actualizarServiciosPorMunicipio();

            actualizarCamposMeta();
            calcularTrimestres();
        }

        function actualizarServiciosPorMunicipio() {
            let totalPersonasGrupo1 = calcularTotalPersonas('Grupo1');
            let totalPersonasGrupo2 = calcularTotalPersonas('Grupo2');
            const totalPersonasMunicipios = totalPersonasGrupo1 + totalPersonasGrupo2;
            document.getElementById('valorServiciosMunicipio').value = totalPersonasMunicipios;

            actualizarCamposMeta();
        }

        function actualizarMaximosPersonas(maxGrupo1, maxGrupo2) {
            document.getElementById('personasAtendidasGrupo1').max = maxGrupo1;
            document.getElementById('personasAtendidasGrupo2').max = maxGrupo2;
        }

        function puedeAgregarPersonas(grupo, cantidad) {
            const maxServicios = grupo === 'Grupo1'
                ? parseInt(document.getElementById('valorServicios').value) || 0
                : parseInt(document.getElementById('valorPersonas').value) || 0;

            const totalActual = calcularTotalPersonas(grupo);
            return (totalActual + cantidad) <= maxServicios;
        }

        // ========================================
        // FUNCIONES DE ACTUALIZACIÓN DE METAS
        // ========================================
        function actualizarCamposMeta() {
            const valorServicios = parseInt(document.getElementById('valorServicios').value) || 0;
            const valorPersonas = parseInt(document.getElementById('valorPersonas').value) || 0;

            // Asignar los valores a los campos de meta
            document.getElementById('inputServicioMeta').value = valorServicios;
            document.getElementById('inputServicioMetas').value = valorPersonas;

            // Calcular el porcentaje
            let porcentaje = 0;
            if (valorServicios > 0) {
                if (valorPersonas > 0) {
                    // Caso normal: calcular proporción
                    porcentaje = (valorPersonas / valorServicios) * 100;
                } else {
                    // Si valorPersonas es 0, considerar 100% de servicios
                    porcentaje = 100;
                }
            porcentaje = Math.round(porcentaje * 100) / 100;
            }

            document.getElementById('inputPorcentajeMeta').value = porcentaje;
        }

                // ========================================
        // FUNCIONES DE CÁLCULO DE TRIMESTRES
        // ========================================
        function calcularTrimestres() {
            // Definir los meses por trimestre
            const trimestres = {
                1: ['ENE', 'FEB', 'MAR'],
                2: ['ABR', 'MAY', 'JUN'],
                3: ['JUL', 'AGO', 'SEP'],
                4: ['OCT', 'NOV', 'DIC']
            };

            // Calcular trimestres para SERVICIOS (grupo1)
            for (let i = 1; i <= 4; i++) {
                let suma = 0;
                trimestres[i].forEach(mes => {
                    const input = document.querySelector(`.mes-grupo1[data-mes="${mes}"]`);
                    if (input) {
                        suma += parseInt(input.value) || 0;
                    }
                });

                // Mapear al campo correspondiente
                const campos = {
                    1: 'primerServicio',
                    2: 'segundoServicio',
                    3: 'tercerServicio',
                    4: 'cuartoServicio'
                };

                document.getElementById(campos[i]).value = suma;
            }

            // Calcular trimestres para PERSONAS (grupo2)
            for (let i = 1; i <= 4; i++) {
                let suma = 0;
                trimestres[i].forEach(mes => {
                    const input = document.querySelector(`.mes-grupo2[data-mes="${mes}"]`);
                    if (input) {
                        suma += parseInt(input.value) || 0;
                    }
                });

                // Mapear al campo correspondiente
                const campos = {
                    1: 'primerPersona',
                    2: 'segundoPersona',
                    3: 'tercerPersona',
                    4: 'cuartoPersona'
                };

                document.getElementById(campos[i]).value = suma;
            }
        }

        // ========================================
        // FUNCIONES DE PERSONAS/MUNICIPIOS
        // ========================================
        function configurarAgregarPersonas(grupo) {
            const btnAgregar = document.getElementById(`btnAgregar${grupo}`);
            const selectEstado = document.getElementById(`selectEstado${grupo}`);
            const inputPersonas = document.getElementById(`personasAtendidas${grupo}`);
            const tbody = document.getElementById(`tbody${grupo}`);
            const tabla = document.getElementById(`tabla${grupo}`);

            btnAgregar.addEventListener('click', function() {
                const estado = selectEstado.value;
                const personas = parseInt(inputPersonas.value) || 0;

                if (!estado) {
                    alert('Por favor, seleccione un municipio');
                    return;
                }

                if (personas <= 0) {
                    alert('Por favor, ingrese un número válido de personas');
                    return;
                }

                if (!puedeAgregarPersonas(grupo, personas)) {
                    const maxServicios = grupo === 'Grupo1'
                        ? parseInt(document.getElementById('valorServicios').value) || 0
                        : parseInt(document.getElementById('valorPersonas').value) || 0;

                    const totalActual = calcularTotalPersonas(grupo);
                    const disponibles = maxServicios - totalActual;
                    alert(`No se pueden agregar ${personas} personas. Solo hay ${disponibles} disponibles en el ${grupo === 'Grupo1' ? 'Grupo Principal' : 'Grupo Acumulable'}.`);
                    return;
                }

                const datos = datosEstados[estado];

                if (!datos) {
                    alert('Error: No se encontraron datos para el municipio seleccionado');
                    return;
                }

                const nuevaFila = document.createElement('tr');
                nuevaFila.innerHTML = `
                    <td>${personas}</td>
                    <td>${datos.municipio}</td>
                    <td>${datos.region}</td>
                    <td>${datos.numeroRegion}</td>
                    <td>${datos.clave}</td>
                    <td><button class="btn btn-sm btn-outline-danger btn-eliminar">Eliminar</button></td>
                `;

                tbody.appendChild(nuevaFila);

                if (tabla.style.display === 'none') {
                    tabla.style.display = 'block';
                }

                nuevaFila.querySelector('.btn-eliminar').addEventListener('click', function() {
                    nuevaFila.remove();
                    calcularTotalPersonas(grupo);
                    actualizarServiciosPorMunicipio();
                    if (tbody.children.length === 0) {
                        tabla.style.display = 'none';
                    }
                });

                calcularTotalPersonas(grupo);
                actualizarServiciosPorMunicipio();
                inputPersonas.value = '0';
                selectEstado.value = '';
            });
        }

        // ========================================
        // CONFIGURACIÓN DE EVENTOS DE SELECTS
        // ========================================
        function configurarSelectDelegaciones() {
            const selectDelegaciones = document.getElementById('selectDelegaciones');
            const inputDelegaciones = document.getElementById('inputDelegaciones');

            inputDelegaciones.disabled = true;

            selectDelegaciones.addEventListener('change', function() {
                const valorSeleccionado = this.value;

                if (valorSeleccionado === 'No') {
                    inputDelegaciones.value = 'N/A';
                    inputDelegaciones.disabled = true;
                } else if (valorSeleccionado === 'Si') {
                    inputDelegaciones.value = '';
                    inputDelegaciones.disabled = false;
                } else {
                    inputDelegaciones.value = '';
                    inputDelegaciones.disabled = true;
                }
            });
        }

        function configurarSelectPersonas() {
            const selectPersonas = document.getElementById('selectPersonas');
            const selectAcumulable = document.getElementById('selectAcumulable');
            const inputsGrupo2 = document.querySelectorAll('.mes-grupo2');

            selectAcumulable.disabled = true;

            selectPersonas.addEventListener('change', function() {
                if (this.value === 'Personas' || this.value === 'instituciones') {
                    selectAcumulable.disabled = false;
                } else {
                    selectAcumulable.disabled = true;
                    selectAcumulable.value = '';

                    inputsGrupo2.forEach(input => {
                        input.disabled = true;
                        input.value = 0;
                    });

                    calcularSumatorias();
                }
            });
        }

        function configurarSelectAcumulable() {
            const selectAcumulable = document.getElementById('selectAcumulable');
            const inputsGrupo2 = document.querySelectorAll('.mes-grupo2');

            selectAcumulable.addEventListener('change', function() {
                const habilitar = this.value === 'si';

                inputsGrupo2.forEach(input => {
                    input.disabled = !habilitar;
                    if (!habilitar) {
                        input.value = 0;
                    }
                });

                calcularSumatorias();
            });
        }

        function configurarSelectProgramaComponente() {
            const $selectPrograma = $('#selectPrograma');
            const $selectComponente = $('#selectComponente');

            const todasOpciones = $selectComponente.find('option:not(:first)').clone();

            $selectPrograma.on('change', function() {
                const programaSeleccionado = $(this).val();

                $selectComponente.find('option:not(:first)').remove();

                if (programaSeleccionado) {
                    todasOpciones.each(function() {
                        if ($(this).data('programa') === programaSeleccionado) {
                            $selectComponente.append($(this).clone());
                        }
                    });

                    $selectComponente.prop('disabled', false);
                } else {
                    $selectComponente.prop('disabled', true);
                }
            });
        }

        // ========================================
        // INICIALIZACIÓN PRINCIPAL
        // ========================================
        document.addEventListener('DOMContentLoaded', async function() {
            // 1. Cargar datos externos
            await cargarMunicipios();

            // 2. Configurar acciones
            configurarAcciones();

            // 3. Configurar selects
            configurarSelectDelegaciones();
            configurarSelectPersonas();
            configurarSelectAcumulable();

            // 4. Configurar personas/municipios
            configurarAgregarPersonas('Grupo1');
            configurarAgregarPersonas('Grupo2');

            // 5. Configurar listeners de inputs
            document.querySelectorAll('.mes-grupo1, .mes-grupo2').forEach(input => {
                input.addEventListener('input', calcularSumatorias);
            });

            // 6. Cálculo inicial
            calcularSumatorias();
        });

        // Inicialización de jQuery (debe ejecutarse después del DOM)
        $(document).ready(function() {
            configurarSelectProgramaComponente();
        });
    </script>
}